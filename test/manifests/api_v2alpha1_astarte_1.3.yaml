#In an ephemeral env such as E2E testing we allow components to allocate resources as needed without setting requests and limits. This approach is not recommended in prod envs.
#For a Pod to be given a QoS class of BestEffort, the Containers in the Pod must not have any memory or CPU limits or requests.

apiVersion: api.astarte-platform.org/v2alpha1
kind: Astarte
metadata:
  name: example-astarte
spec:
  # This is the most minimal set of reasonable configuration to spin up an Astarte
  # instance with reasonable defaults and enough control over the deployment.
  version: 1.3-snapshot
  api:
    host: "api.astarte-example.com" # MANDATORY
  # RabbitMQ can be deployed either in cluster or out of cluster.
  # What follows is just an in-cluster example.
  rabbitmq:
    connection:
      host: "rabbitmq.rabbitmq.svc.cluster.local"
      port: 5672
      credentialsSecret:
        name: "rabbitmq-connection-secret"
        usernameKey: "username"
        passwordKey: "password"
  # Cassandra/ScyllaDB can be deployed either in cluster or out of cluster.
  # What follows is just an in-cluster example.
  cassandra:
    connection:
      nodes:
      - host: "scylla-local-kind-1-local-kind-1a-0.scylla.svc.cluster.local"
        port: 9042
      credentialsSecret:
        name: "scylladb-connection-secret"
        usernameKey: "username"
        passwordKey: "password"
  vernemq:
    host: "broker.astarte-example.com"
    port: 8883
  cfssl:
    storage:
      size: 2Gi
  components:
    housekeeping:
      additionalEnv:
        - name: "HOUSEKEEPING_AMQP_HOST"
          value: "rabbitmq.rabbitmq.svc.cluster.local"
        - name: "HOUSEKEEPING_AMQP_PORT"
          value: "5672"
        - name: "HOUSEKEEPING_AMQP_USERNAME"
          value: "guest"
        - name: "HOUSEKEEPING_AMQP_PASSWORD"
          value: "guest"
    dashboard:
      image: "docker.io/astarte/astarte-dashboard:1.2.1-rc.0"
      deploy: true
